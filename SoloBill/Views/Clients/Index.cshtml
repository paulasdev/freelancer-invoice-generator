@model IEnumerable<Client>
@{
    ViewData["Title"] = "Clients";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-purple">Clients</h2>
        <a class="btn btn-purple" asp-action="Create">+ Add Client</a>
    </div>

    <div class="input-group mb-3">
        <input type="text" id="clientSearch" class="form-control" placeholder="Search clients..." />
        <span class="input-group-text"><i class="fas fa-search"></i></span>
    </div>

    <div class="table-responsive">
        <table class="table table-hover bg-white shadow-sm rounded" id="clientTable">
            <thead class="table-light">
                <tr>
                    <th class="sortable" onclick="sortTable(0)">Name</th>
                    <th class="sortable" onclick="sortTable(1)">Email</th>
                    <th class="sortable" onclick="sortTable(2)">Company</th>
                    <th class="sortable" onclick="sortTable(3)">Address</th>
                    <th class="sortable" onclick="sortTable(4)"># Invoices</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var client in Model)
                {
                    <tr>
                        <td>@client.Name</td>
                        <td>@client.Email</td>
                        <td>@client.Company</td>
                        <td>@client.Address</td>
                        <td>@client.Invoices?.Count() ?? 0</td>
                       <td class="text-end">
    <div class="drostart">
        <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li>
                <a class="dropdown-item" href="/Clients/Details/@client.ClientId">
                    <i class="bi bi-eye me-2"></i>Details
                </a>
            </li>
            <li>
                <a class="dropdown-item" href="/Clients/Edit/@client.ClientId">
                    <i class="bi bi-pencil-square me-2"></i>Edit
                </a>
            </li>
            <li>
                <form method="post" action="/Clients/Delete/@client.ClientId" onsubmit="return confirm('Are you sure you want to delete this client?');">
                    @Html.AntiForgeryToken()
                    <button class="dropdown-item text-danger" type="submit">
                        <i class="bi bi-trash3 me-2"></i>Delete
                    </button>
                </form>
            </li>
        </ul>
    </div>
</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // Real-time search
        document.getElementById("clientSearch").addEventListener("keyup", function () {
            var input = this.value.toLowerCase();
            var rows = document.querySelectorAll("#clientTable tbody tr");

            rows.forEach(function (row) {
                row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
            });
        });

        // Sortable columns
        function sortTable(colIndex) {
            var table = document.getElementById("clientTable");
            var rows = Array.from(table.rows).slice(1);
            var isAsc = table.getAttribute("data-sort") !== "asc";

            rows.sort(function (a, b) {
                return (a.cells[colIndex].innerText.localeCompare(b.cells[colIndex].innerText)) * (isAsc ? 1 : -1);
            });

            rows.forEach(row => table.appendChild(row));
            table.setAttribute("data-sort", isAsc ? "asc" : "desc");
        }
    </script>
}